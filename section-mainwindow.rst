Main Window
===========

The only fixed UI elements in ngscopeclient are the main menu and toolbar at the top of the window. All remaining space
may be filled with waveform plots, properties dialogs, protocol analyzers, and other dockable windows as required for a
given experimental setup. This flexibility allows almost the entire screen to be dedicated to waveform views, or more
space allocated to controls and protocol decodes.

Menu
----

File
^^^^

This menu contains commands for saving and loading session files.

*   ``Open Online...``

    Loads a session file and reconnects to the instrument(s) to continue existing work. Settings from the saved
    session will be applied and overwrite the current channel and timebase configuration of the instrument, if different.

*   ``Open Offline...``

    Loads a session file in offline mode, allowing you to work with saved waveform data without connecting to the
    instrument(s) the data was captured from.

*   ``Recent Files``

    Displays a list of recently accessed session files and allows them to be opened online or offline.

*   ``Save``

    Saves UI configuration and waveform data (including history) to a session file for future use.

    A session consists of a YAML file called *filename*.scopesession containing instrument and UI configuration, as
    well as a directory called *filename*\_data which contains waveform metadata and sample values for all enabled
    instrument channels, including history.

    Note that both the .scopesession and the _data directory must be copied if moving the session to a new location in
    order to preserve waveform data. If you only wish to restore the filter graph and UI configuration without waveform
    content, the _data directory is not required.

*   ``Save As...``

    Saves the session to a new file, rather than the current one.

*   ``Close``

    Close the current session without exiting ngscopeclient.

*   ``Quit``

    Exits the application.

View
^^^^

*   ``Fullscreen``

    Toggles full-screen mode

*   ``Persistence Setup``

    Opens the Persistence Setup dialog, allowing you to control the decay coefficient for persistence maps.

Add
^^^

This menu allows new waveforms views or instrument connections to be created.

*   ``BERT``

    Connect to a new, or recently used, bit error rate tester

*   ``Function Generator``

    Connect to a new, or recently used, function generator

*   ``Load``

    Connect to a new, or recently used, electronic load

*   ``Misc``

    Connect to a new, or recently used, miscellaneous instrument

*   ``Multimeter``

    Connect to a new, or recently used, multimeter

*   ``Oscilloscope``

    Connect to a new, or recently used, oscilloscope

*   ``Power Supply``

    Connect to a new, or recently used, power supply

*   ``RF Generator``

    Connect to a new, or recently used, RF signal generator

*   ``SDR``

    Connect to a new, or recently used, software-defined radio

*   ``Spectrometer``

    Connect to a new, or recently used, optical spectrometer

*   ``VNA``

    Connect to a new, or recently used, vector network analyzer

*   ``Channels``

    Displays a list of filters and instrument channels which can be opened in a new waveform view

*   ``Generate``

    Allows synthetic waveforms to be generated for testing, simulation, and channel design applications

*   ``Import``

    Allows waveforms to be loaded from external data files in various interchange formats

Setup
^^^^^

*   ``Manage Instruments...``

    Opens the Manage Instruments dialog, which allows control over synchronization, deskewing, and cross-triggering of
    multiple instruments.

*   ``Timebase...``

    Opens the :ref:`Timebase Properties <dlg:timebase>` dialog, allowing sample rate and memory depth of each connected
    instrument to be adjusted.

*   ``Trigger...``

    Opens the Trigger dialog, allowing configuration of trigger settings.

*   ``Preferences...``

    Opens the :ref:`Preferences <dlg:preferences>` dialog.

Window
^^^^^^

This menu provides access to various utility windows.

*   ``Analyzer``

    Opens protocol analyzer dialogs for active protocol decodes

*   ``Generator``

    Opens the properties dialog for a currently connected function generator

*   ``Multimeter``

    Opens the properties dialog for a currently connected multimeter

*   ``Power Supply``

    Opens the properties dialog for a currently connected power supply

*   ``Lab Notes``

    Opens the :ref:`Lab Notes <dlg:labnotes>` dialog, allowing you to take notes on your experiment.

*   ``Log Viewer``

    Opens the :ref:`Log Viewer dialog <dlg:logviewer>`,  allowing you to see debug log messages generated by the
    application. This is the same log stream which is normally written to stdout, but this dialog allows it to be accessed
    even when the application was not launched from a shell session and stdout is thus inaccessible.

*   ``Measurements``

    Opens the Measurements window, displaying scalar-valued measurements coming from instrument channels or filter blocks.

*   ``Performance Metrics``

    Opens the :ref:`Performance Metrics <dlg:perfmetrics>` window, which provides access to debug information which can
    be helpful when debugging slow application performance, optimizing the code, or benchmarking instruments.

*   ``History``

    Opens the History dialog (see :numref:`sec:history`), which allows access to a rolling buffer of recently acquired
    waveforms.

*   ``Filter Graph``

    Reopens the filter graph editor if it had been closed.

*   ``Stream Browser``

    Reopens the stream browser if it had been closed.

*   ``Filter Palette``

    Reopens the filter palette if it had been closed.

*   ``New Workspace``

    Create a new workspace to organize other windows in.

Debug
^^^^^

Provides access to GUI toolkit test dialogs and other features intended only for developers.

*   ``SCPI Console``

    Opens a console window allowing you to send raw SCPI commands to a currently connected instrument.

    This is a low level debug tool primarily intended for use by driver developers. The console is interlocked with
    background threads polling the instrument, so that replies to commands typed in the console will not be mixed with
    replies which the instrument driver is expecting to its own commands. However, commands sent in the console will bypass
    any caching in the driver and can easily lead to the driver and instrument firmware states becoming mutually
    inconsistent.

*   ``ImGui Demo``

    Launches a GUI library demo window allowing you to test out various widgets and features

*   ``Memory Leaker``

    Allows you to allocate a large block of memory (up to 4GB per dialog instance, but multiple dialogs may be spawned) in
    order to induce video or system memory pressure.

Help
^^^^

**About**: Displays program version and copyright information

Toolbar
-------

.. WARNING::
   This section is outdated and needs to be revised for ngscopeclient.

The toolbar contains buttons and controls for the most frequently used actions.

.. _toolbar:
.. figure:: images/toolbar.png
    :figclass: align-center

    glscopeclient toolbar

Capture buttons
^^^^^^^^^^^^^^^

The capture button group (:numref:`capturebuttons`) contains three buttons. From left to right these are "arm
normal trigger", "arm one-shot trigger" and "stop trigger".

Note that the "normal" trigger mode still uses one-shot capture internally so that all waveform data can be downloaded
before the next trigger event.

.. _capturebuttons:
.. figure:: images/capture-icons.png
    :figclass: align-center

    Capture control buttons

History
^^^^^^^

The history button (:numref:`historybutton`) toggles display of the :ref:`waveform history view <sec:history>`.

.. _historybutton:
.. figure:: images/history-button.png
    :figclass: align-center

    History button

Refresh Settings
^^^^^^^^^^^^^^^^

In order to improve performance, ngscopeclient caches many instrument settings locally rather than constantly querying
the instrument for the current timebase, trigger configuration, etc. If settings are changed via the instrument front
panel while ngscopeclient is running, ngscopeclient may not be aware of these changes.

The Refresh Settings button (:numref:`refreshbutton`) clears all cached instrument configuration and updates
ngscopeclient with the current instrument settings. For most "headless" instruments, such as Pico Technology devices,
this button has no effect.

.. _refreshbutton:
.. figure:: images/refresh-button.png
    :figclass: align-center

    Refresh Settings button

Clear Sweeps
^^^^^^^^^^^^

The Clear Sweeps button (:numref:`clearbutton`) clears all persistence waveforms, accumulated eye pattern / waterfall
data, and statistics. Waveforms saved in history are not deleted.

.. _clearbutton:
.. figure:: images/clear-button.png
    :figclass: align-center

    Clear Sweeps button

Fullscreen
^^^^^^^^^^

The Fullscreen button (:numref:`fullscreenbutton`) switches ngscopeclient between normal and full-screen mode.

.. _fullscreenbutton:
.. figure:: images/fullscreen-button.png
    :figclass: align-center

    Fullscreen button

Opacity slider
^^^^^^^^^^^^^^

The opacity slider (:numref:`opacityslider`) controls the alpha/opacity used to display intensity-graded waveforms.
Higher opacity values lead to better display of sparse waveforms (compare the crisp lines of Fig. \ref{sparse-waveform}
to the barely visible trace in :numref:`dim-waveform`) but can lead to a washed-out appearance if too many sample
points are shoved into a small area.

.. _opacityslider:
.. figure:: images/opacity-slider.png
    :figclass: align-center

    Trace opacity slider

.. _sparse-waveform:
.. figure:: images/sparse-waveform.png
    :figclass: align-center

    Sparse waveform at a high zoom level

.. _dim-waveform:
.. figure:: images/dim-waveform.png
    :figclass: align-center

    Dim waveform showing difficulty of seeing waveform at low opacity

For example, the DVI waveform in :numref:`washedout-waveform` looks like a solid white blob with a vaguely visible
outline. No fine detail can be observed other than the increased over/undershoot and random-looking edges on the
scanlines, compared to the flat appearance of the blanking period between scanlines and at the end of the frame.

When the opacity is reduced in this example, many more nuances of the signal become apparent. The high/low voltage
levels of the signal compared to the transitions between them are obvious, and the H/V sync pulses within the blanking
period show up as a slightly darker region.

.. _washedout-waveform:
.. figure:: images/washedout-waveform.png
    :figclass: align-center

    Intensity-graded waveform showing washed-out appearance at high opacity

.. _graded-waveform:
.. figure:: images/graded-waveform.png
    :figclass: align-center

    Intensity-graded waveform at lower opacity level

As of this writing, the opacity setting is global for the entire application. Should this be changed to per waveform
group? If so, how should the group be selected and should there still be an option to make changes globally?
